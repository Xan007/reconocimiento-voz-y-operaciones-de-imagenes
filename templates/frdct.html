{% extends 'base.html' %}

{% block title %}P√°gina eliminada{% endblock %}

{% block content %}
<div class="section-card" style="max-width:800px;margin:2rem auto;padding:1.5rem;">
    <h1>üìÑ P√°gina eliminada</h1>
    <p>La p√°gina <strong>"Cifrado con FrDCT"</strong> ha sido eliminada del sitio.</p>
    <p>Puedes volver a la <a href="{{ url_for('index') }}">p√°gina principal</a> o a la secci√≥n de <a href="{{ url_for('encryption') }}">Encriptaci√≥n Completa</a>.</p>
</div>
{% endblock %}
    text-align: center;
    margin-bottom: 2rem;
}

.page-header h1 {
    color: var(--primary);
    margin-bottom: 0.5rem;
}

.page-header p {
    color: var(--gray);
    max-width: 700px;
    margin: 0 auto;
}

.section-card {
    background: white;
    border-radius: 12px;
    padding: 1.5rem;
    box-shadow: 0 4px 15px rgba(0, 102, 204, 0.12);
    margin-bottom: 1.5rem;
    border-top: 4px solid var(--primary);
}

.section-card h2 {
    color: var(--primary);
    margin: 0 0 1rem 0;
    font-size: 1.3rem;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.section-card h2 .step-number {
    background: var(--primary);
    color: white;
    width: 28px;
    height: 28px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 0.9rem;
}

/* Upload area */
.upload-area {
    border: 3px dashed var(--primary);
    border-radius: 12px;
    padding: 2rem;
    text-align: center;
    cursor: pointer;
    transition: all 0.3s ease;
    background: #f8fafc;
}

.upload-area:hover {
    background: rgba(0, 102, 204, 0.05);
    border-color: #004499;
}

.upload-area.dragover {
    background: rgba(0, 102, 204, 0.1);
    border-color: #004499;
}

.upload-icon {
    font-size: 3rem;
    margin-bottom: 1rem;
    display: block;
}

.upload-area p {
    margin: 0.5rem 0;
    color: #333;
}

.upload-area small {
    color: var(--gray);
}

/* Images grid */
.images-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 1.5rem;
    margin-top: 1.5rem;
}

.image-box {
    background: #f8fafc;
    border-radius: 10px;
    padding: 1rem;
    text-align: center;
}

.image-box h4 {
    margin: 0 0 0.8rem 0;
    color: var(--primary);
    font-size: 0.95rem;
}

.image-box img {
    max-width: 100%;
    max-height: 400px;
    border-radius: 8px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    background: #fff;
    image-rendering: pixelated; /* Para que se vea n√≠tido si es peque√±a */
}

.image-box .placeholder {
    width: 100%;
    height: 200px;
    background: #e5e7eb;
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--gray);
    font-size: 0.9rem;
}

/* Alpha input */
.alpha-input-group {
    display: flex;
    align-items: center;
    gap: 1rem;
    margin: 1rem 0;
    flex-wrap: wrap;
}

.alpha-input-group label {
    font-weight: 600;
    color: #333;
    min-width: 100px;
}

.alpha-input-group input[type="number"] {
    padding: 0.7rem 1rem;
    border: 2px solid #e0e0e0;
    border-radius: 8px;
    font-size: 1rem;
    width: 150px;
    transition: border-color 0.2s;
}

.alpha-input-group input[type="number"]:focus {
    outline: none;
    border-color: var(--primary);
}

.alpha-hint {
    font-size: 0.85rem;
    color: var(--gray);
    margin-left: 0.5rem;
}

/* Buttons */
.btn {
    padding: 0.8rem 1.5rem;
    border: none;
    border-radius: 8px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s;
    font-size: 0.95rem;
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
}

.btn-primary {
    background: var(--primary);
    color: white;
}

.btn-primary:hover:not(:disabled) {
    background: #004d99;
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0, 102, 204, 0.3);
}

.btn-success {
    background: var(--success);
    color: white;
}

.btn-success:hover:not(:disabled) {
    background: #16a34a;
    transform: translateY(-2px);
}

.btn-warning {
    background: var(--warning);
    color: white;
}

.btn-warning:hover:not(:disabled) {
    background: #d97706;
    transform: translateY(-2px);
}

.btn:disabled {
    opacity: 0.6;
    cursor: not-allowed;
}

.button-group {
    display: flex;
    gap: 1rem;
    flex-wrap: wrap;
    margin-top: 1rem;
}

/* Status messages */
.status-message {
    padding: 1rem;
    border-radius: 8px;
    margin: 1rem 0;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.status-message.info {
    background: #e0f2fe;
    color: #0369a1;
    border-left: 4px solid #0ea5e9;
}

.status-message.success {
    background: #dcfce7;
    color: #166534;
    border-left: 4px solid var(--success);
}

.status-message.error {
    background: #fef2f2;
    color: #991b1b;
    border-left: 4px solid var(--danger);
}

.status-message.warning {
    background: #fffbeb;
    color: #92400e;
    border-left: 4px solid var(--warning);
}

/* Info box */
.info-box {
    background: linear-gradient(135deg, #e8f4fd 0%, #f0f7ff 100%);
    padding: 1.2rem;
    border-radius: 8px;
    border-left: 4px solid var(--primary);
    margin: 1rem 0;
}

.info-box h4 {
    margin: 0 0 0.5rem 0;
    color: var(--primary);
}

.info-box p {
    margin: 0.3rem 0;
    color: #333;
    font-size: 0.95rem;
}

.info-box code {
    background: rgba(0, 102, 204, 0.1);
    padding: 2px 6px;
    border-radius: 4px;
    font-family: monospace;
}

/* Formula display */
.formula-box {
    background: #f8fafc;
    padding: 1rem;
    border-radius: 8px;
    margin: 1rem 0;
    overflow-x: auto;
}

.formula-box .formula {
    font-family: 'Times New Roman', serif;
    font-size: 1.1rem;
    text-align: center;
    color: #333;
}

/* Loading spinner */
.loading-overlay {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(255,255,255,0.9);
    display: none;
    align-items: center;
    justify-content: center;
    z-index: 9999;
    flex-direction: column;
}

.loading-overlay.show {
    display: flex;
}

.spinner {
    width: 50px;
    height: 50px;
    border: 4px solid #e0e0e0;
    border-top-color: var(--primary);
    border-radius: 50%;
    animation: spin 1s linear infinite;
}

@keyframes spin {
    to { transform: rotate(360deg); }
}

.loading-text {
    margin-top: 1rem;
    color: var(--primary);
    font-weight: 600;
}

/* Comparison section */
.comparison-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 2rem;
    margin-top: 1rem;
}

@media (max-width: 768px) {
    .comparison-grid {
        grid-template-columns: 1fr;
    }
    
    .images-grid {
        grid-template-columns: 1fr;
    }
}

.comparison-item {
    background: #f8fafc;
    padding: 1rem;
    border-radius: 10px;
    text-align: center;
}

.comparison-item h4 {
    margin: 0 0 0.8rem 0;
    color: var(--primary);
}

.comparison-item img {
    max-width: 100%;
    max-height: 400px;
    border-radius: 8px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    image-rendering: pixelated;
}

.match-indicator {
    margin-top: 0.8rem;
    padding: 0.5rem 1rem;
    border-radius: 20px;
    font-weight: 600;
    font-size: 0.9rem;
    display: inline-block;
}

.match-indicator.match {
    background: var(--success);
    color: white;
}

.match-indicator.no-match {
    background: var(--danger);
    color: white;
}

/* Hidden elements */
.hidden {
    display: none !important;
}

/* Download button */
.download-btn {
    margin-top: 0.8rem;
}
</style>

<div class="frdct-container">
    <div class="page-header">
        <h1>üîê Cifrado con FrDCT</h1>
        <p>Cifra y descifra im√°genes usando la Transformada Discreta del Coseno Fraccionaria (FrDCT). 
           Solo con el par√°metro Œ± correcto se puede recuperar la imagen original.</p>
    </div>

    <!-- PASO 1: Subir imagen -->
    <div class="section-card">
        <h2><span class="step-number">1</span> Subir Imagen</h2>
        
        <div class="upload-area" id="uploadArea">
            <input type="file" id="imageInput" accept="image/*" style="display:none;">
            <span class="upload-icon">üìÅ</span>
            <p><strong>Haz clic o arrastra una imagen aqu√≠</strong></p>
            <small>Formatos: JPG, PNG, BMP (se mantienen las dimensiones originales)</small>
        </div>
        
        <div id="uploadStatus" class="status-message info hidden">
            <i class="fas fa-info-circle"></i>
            <span id="uploadStatusText">Esperando imagen...</span>
        </div>
        
        <div class="images-grid hidden" id="originalImagesGrid">
            <div class="image-box">
                <h4>üì∑ Imagen Original</h4>
                <img id="originalImage" src="" alt="Original">
            </div>
            <div class="image-box">
                <h4>‚¨õ Escala de Grises</h4>
                <img id="grayscaleImage" src="" alt="Grises">
            </div>
        </div>
    </div>

    <!-- PASO 2: Cifrar -->
    <div class="section-card hidden" id="encryptSection">
        <h2><span class="step-number">2</span> Cifrar con FrDCT</h2>
        
        <div class="info-box">
            <h4>‚ÑπÔ∏è Sobre el par√°metro Œ±</h4>
            <p>El valor de <code>Œ±</code> act√∫a como la "clave" de cifrado. Valores permitidos: <code>0</code> a <code>1.99</code>.</p>
            <p>Cuando <code>Œ± = 0</code>, la FrDCT act√∫a como identidad (la imagen cifrada = original).</p>
            <p>Cuando <code>Œ± = 1</code>, se comporta similar a la DCT tradicional.</p>
            <p>‚ö†Ô∏è <strong>Nota:</strong> Œ± = 2 produce una matriz singular y no es invertible.</p>
        </div>
        
        <div class="alpha-input-group">
            <label for="encryptAlpha">Œ± de cifrado:</label>
            <input type="number" id="encryptAlpha" value="0.5" step="0.01" min="0" max="1.99">
            <span class="alpha-hint">Valor permitido: 0 a 1.99 ‚Äî guarda este valor para descifrar</span>
        </div>
        
        <div class="button-group">
            <button class="btn btn-primary" id="encryptBtn">
                <i class="fas fa-lock"></i> Cifrar Imagen
            </button>
        </div>
        
        <div id="encryptStatus" class="status-message info hidden">
            <span id="encryptStatusText"></span>
        </div>
        
        <div class="images-grid hidden" id="encryptedImagesGrid">
            <div class="image-box">
                <h4>üîí Imagen Cifrada (Coeficientes FrDCT)</h4>
                <img id="encryptedImage" src="" alt="Cifrada">
                <p style="font-size: 0.85rem; color: var(--gray); margin-top: 0.5rem;">
                    Visualizaci√≥n normalizada de los coeficientes
                </p>
            </div>
        </div>
    </div>

    <!-- PASO 3: Descifrar -->
    <div class="section-card hidden" id="decryptSection">
        <h2><span class="step-number">3</span> Descifrar con FrDCT Inversa</h2>
        
        <div class="info-box">
            <h4>üîë Prueba de seguridad</h4>
            <p>Intenta descifrar con diferentes valores de <code>Œ±</code>. Solo el valor correcto reconstruir√° la imagen original.</p>
        </div>
        
        <div class="alpha-input-group">
            <label for="decryptAlpha">Œ± de descifrado:</label>
            <input type="number" id="decryptAlpha" value="0.5" step="0.01" min="0" max="1.99">
            <span class="alpha-hint">Valor permitido: 0 a 1.99 ‚Äî prueba valores diferentes</span>
        </div>
        
        <div class="button-group">
            <button class="btn btn-success" id="decryptBtn">
                <i class="fas fa-unlock"></i> Descifrar Imagen
            </button>
            <button class="btn btn-warning" id="decryptWrongBtn">
                <i class="fas fa-random"></i> Descifrar con Œ± Aleatorio
            </button>
        </div>
        
        <div id="decryptStatus" class="status-message info hidden">
            <span id="decryptStatusText"></span>
        </div>
        
        <div class="comparison-grid hidden" id="comparisonGrid">
            <div class="comparison-item">
                <h4>üì∑ Imagen Original</h4>
                <img id="compareOriginal" src="" alt="Original">
            </div>
            <div class="comparison-item">
                <h4>üîì Imagen Descifrada</h4>
                <img id="decryptedImage" src="" alt="Descifrada">
                <div id="matchIndicator" class="match-indicator hidden"></div>
            </div>
        </div>
        
        <div id="alphaComparison" class="info-box hidden">
            <h4>üìä Comparaci√≥n de Œ±</h4>
            <p><strong>Œ± de cifrado:</strong> <span id="usedEncryptAlpha">-</span></p>
            <p><strong>Œ± de descifrado:</strong> <span id="usedDecryptAlpha">-</span></p>
            <p id="alphaMatchText"></p>
        </div>
    </div>

    <!-- Informaci√≥n te√≥rica -->
    <div class="section-card">
        <h2><i class="fas fa-book"></i> F√≥rmulas Implementadas</h2>
        
        <div class="formula-box">
            <h4 style="margin: 0 0 0.5rem 0; color: var(--primary);">FrDCT 2D (Ecuaci√≥n 1.14)</h4>
            <p class="formula">
                F<sup>Œ±</sup>(u,v) = (C(u)C(v) / ‚àöNM) √ó Œ£<sub>x</sub> Œ£<sub>y</sub> f(x,y) √ó 
                cos[œÄ/N √ó (u + Œ±/2)(x + ¬Ω)] √ó cos[œÄ/M √ó (v + Œ±/2)(y + ¬Ω)]
            </p>
        </div>
        
        <div class="formula-box">
            <h4 style="margin: 0 0 0.5rem 0; color: var(--primary);">FrDCT Inversa 2D (Ecuaci√≥n 1.15)</h4>
            <p class="formula">
                f(x,y) = (1/NM) √ó Œ£<sub>u</sub> Œ£<sub>v</sub> C(u)C(v) √ó F<sup>Œ±</sup>(u,v) √ó 
                cos[œÄ/N √ó (u + Œ±/2)(x + ¬Ω)] √ó cos[œÄ/M √ó (v + Œ±/2)(y + ¬Ω)]
            </p>
        </div>
        
        <div class="formula-box">
            <h4 style="margin: 0 0 0.5rem 0; color: var(--primary);">Factor de Normalizaci√≥n C(k)</h4>
            <p class="formula">
                C(k) = 1/‚àö2 si k = 0 &nbsp;|&nbsp; C(k) = 1 si k ‚â† 0
            </p>
        </div>
    </div>
</div>

<!-- Loading overlay -->
<div class="loading-overlay" id="loadingOverlay">
    <div class="spinner"></div>
    <div class="loading-text" id="loadingText">Procesando...</div>
</div>

<script>
// Estado global
let originalImageBase64 = null;
let grayscaleImageBase64 = null;
let encryptedData = null;  // Coeficientes FrDCT (guardados como JSON)
let usedEncryptAlpha = null;

// Elementos
const uploadArea = document.getElementById('uploadArea');
const imageInput = document.getElementById('imageInput');
const uploadStatus = document.getElementById('uploadStatus');
const uploadStatusText = document.getElementById('uploadStatusText');
const originalImagesGrid = document.getElementById('originalImagesGrid');
const encryptSection = document.getElementById('encryptSection');
const decryptSection = document.getElementById('decryptSection');
const loadingOverlay = document.getElementById('loadingOverlay');
const loadingText = document.getElementById('loadingText');

// Upload handlers
uploadArea.addEventListener('click', () => imageInput.click());

uploadArea.addEventListener('dragover', (e) => {
    e.preventDefault();
    uploadArea.classList.add('dragover');
});

uploadArea.addEventListener('dragleave', () => {
    uploadArea.classList.remove('dragover');
});

uploadArea.addEventListener('drop', (e) => {
    e.preventDefault();
    uploadArea.classList.remove('dragover');
    if (e.dataTransfer.files.length) {
        imageInput.files = e.dataTransfer.files;
        handleImageUpload();
    }
});

imageInput.addEventListener('change', handleImageUpload);

async function handleImageUpload() {
    const file = imageInput.files[0];
    if (!file) return;
    
    showStatus(uploadStatus, uploadStatusText, 'info', `Procesando: ${file.name}...`);
    
    const reader = new FileReader();
    reader.onload = async (e) => {
        try {
            originalImageBase64 = e.target.result;
            document.getElementById('originalImage').src = originalImageBase64;
            
            // Convertir a escala de grises en el servidor
            showLoading('Convirtiendo a escala de grises...');
            
            const response = await fetch('/api/frdct/grayscale', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({image_base64: originalImageBase64})
            });
            
            const data = await response.json();
            hideLoading();
            
            if (data.success) {
                grayscaleImageBase64 = data.image;
                document.getElementById('grayscaleImage').src = grayscaleImageBase64;
                
                // Advertencia si la imagen es muy grande
                const pixels = data.width * data.height;
                let sizeWarning = '';
                if (pixels > 250000) {
                    sizeWarning = ' ‚ö†Ô∏è Imagen grande, el cifrado puede tardar varios segundos.';
                } else if (pixels > 100000) {
                    sizeWarning = ' ‚è±Ô∏è Procesamiento puede tardar unos segundos.';
                }
                
                showStatus(uploadStatus, uploadStatusText, 'success', 
                    `‚úÖ Imagen cargada: ${data.width}√ó${data.height} p√≠xeles (${pixels.toLocaleString()} px)${sizeWarning}`);
                
                originalImagesGrid.classList.remove('hidden');
                encryptSection.classList.remove('hidden');
                
                // Reset estado de cifrado
                encryptedData = null;
                usedEncryptAlpha = null;
                decryptSection.classList.add('hidden');
                document.getElementById('encryptedImagesGrid').classList.add('hidden');
            } else {
                showStatus(uploadStatus, uploadStatusText, 'error', `‚ùå Error: ${data.error}`);
            }
        } catch (error) {
            hideLoading();
            showStatus(uploadStatus, uploadStatusText, 'error', `‚ùå Error: ${error.message}`);
        }
    };
    reader.readAsDataURL(file);
}

// Encrypt button
document.getElementById('encryptBtn').addEventListener('click', async () => {
    if (!grayscaleImageBase64) {
        showStatus(document.getElementById('encryptStatus'), 
                   document.getElementById('encryptStatusText'), 
                   'error', '‚ùå Primero sube una imagen');
        return;
    }
    
    const alpha = parseFloat(document.getElementById('encryptAlpha').value);
    if (isNaN(alpha) || alpha < 0 || alpha >= 2) {
        showStatus(document.getElementById('encryptStatus'), 
                   document.getElementById('encryptStatusText'), 
                   'error', '‚ùå Valor de Œ± inv√°lido');
        return;
    }
    
    showLoading(`Cifrando con FrDCT (Œ± = ${alpha})...`);
    
    try {
        const response = await fetch('/api/frdct/encrypt', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({
                image_base64: grayscaleImageBase64,
                alpha: alpha
            })
        });
        
        const data = await response.json();
        hideLoading();
        
        if (data.success) {
            encryptedData = data.encrypted_data;  // JSON de coeficientes
            usedEncryptAlpha = alpha;
            
            document.getElementById('encryptedImage').src = data.encrypted_visual;
            document.getElementById('encryptedImagesGrid').classList.remove('hidden');
            
            showStatus(document.getElementById('encryptStatus'), 
                       document.getElementById('encryptStatusText'), 
                       'success', `‚úÖ Imagen cifrada con Œ± = ${alpha}`);
            
            // Mostrar secci√≥n de descifrado
            decryptSection.classList.remove('hidden');
            document.getElementById('decryptAlpha').value = alpha;
            
            // Preparar comparaci√≥n
            document.getElementById('compareOriginal').src = grayscaleImageBase64;
        } else {
            showStatus(document.getElementById('encryptStatus'), 
                       document.getElementById('encryptStatusText'), 
                       'error', `‚ùå Error: ${data.error}`);
        }
    } catch (error) {
        hideLoading();
        showStatus(document.getElementById('encryptStatus'), 
                   document.getElementById('encryptStatusText'), 
                   'error', `‚ùå Error: ${error.message}`);
    }
});

// Decrypt button
document.getElementById('decryptBtn').addEventListener('click', async () => {
    await decryptWithAlpha(parseFloat(document.getElementById('decryptAlpha').value));
});

// Decrypt with random alpha
document.getElementById('decryptWrongBtn').addEventListener('click', async () => {
    // Generar alpha aleatorio diferente al usado (0..2)
    let randomAlpha;
    if (usedEncryptAlpha == null) {
        randomAlpha = (Math.random() * 2).toFixed(2);
    } else {
        do {
            randomAlpha = (Math.random() * 2).toFixed(2);
        } while (Math.abs(parseFloat(randomAlpha) - usedEncryptAlpha) < 0.01);
    }
    
    document.getElementById('decryptAlpha').value = randomAlpha;
    await decryptWithAlpha(parseFloat(randomAlpha));
});

async function decryptWithAlpha(alpha) {
    if (!encryptedData) {
        showStatus(document.getElementById('decryptStatus'), 
                   document.getElementById('decryptStatusText'), 
                   'error', '‚ùå Primero cifra una imagen');
        return;
    }
    
    if (isNaN(alpha) || alpha < 0 || alpha >= 2) {
        showStatus(document.getElementById('decryptStatus'), 
                   document.getElementById('decryptStatusText'), 
                   'error', '‚ùå Valor de Œ± inv√°lido');
        return;
    }
    
    showLoading(`Descifrando con FrDCT inversa (Œ± = ${alpha})...`);
    
    try {
        const response = await fetch('/api/frdct/decrypt', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({
                encrypted_data: encryptedData,
                alpha: alpha
            })
        });
        
        const data = await response.json();
        hideLoading();
        
        if (data.success) {
            document.getElementById('decryptedImage').src = data.decrypted_image;
            document.getElementById('comparisonGrid').classList.remove('hidden');
            
            // Mostrar indicador de coincidencia
            const alphaMatch = Math.abs(alpha - usedEncryptAlpha) < 0.001;
            const matchIndicator = document.getElementById('matchIndicator');
            matchIndicator.classList.remove('hidden', 'match', 'no-match');
            
            if (alphaMatch) {
                matchIndicator.classList.add('match');
                matchIndicator.textContent = '‚úÖ Œ± coincide - Imagen reconstruida';
            } else {
                matchIndicator.classList.add('no-match');
                matchIndicator.textContent = '‚ùå Œ± no coincide - Reconstrucci√≥n fallida';
            }
            
            // Mostrar comparaci√≥n de Œ±
            document.getElementById('alphaComparison').classList.remove('hidden');
            document.getElementById('usedEncryptAlpha').textContent = usedEncryptAlpha;
            document.getElementById('usedDecryptAlpha').textContent = alpha;
            
            const alphaMatchText = document.getElementById('alphaMatchText');
            if (alphaMatch) {
                alphaMatchText.innerHTML = '<strong style="color: var(--success);">‚úÖ Los valores de Œ± coinciden. La imagen se ha reconstruido correctamente.</strong>';
            } else {
                alphaMatchText.innerHTML = `<strong style="color: var(--danger);">‚ùå Los valores de Œ± NO coinciden (diferencia: ${Math.abs(alpha - usedEncryptAlpha).toFixed(4)}). La imagen NO se puede reconstruir.</strong>`;
            }
            
            showStatus(document.getElementById('decryptStatus'), 
                       document.getElementById('decryptStatusText'), 
                       alphaMatch ? 'success' : 'warning', 
                       alphaMatch ? `‚úÖ Descifrado exitoso con Œ± = ${alpha}` : `‚ö†Ô∏è Descifrado con Œ± = ${alpha} (incorrecto)`);
        } else {
            showStatus(document.getElementById('decryptStatus'), 
                       document.getElementById('decryptStatusText'), 
                       'error', `‚ùå Error: ${data.error}`);
        }
    } catch (error) {
        hideLoading();
        showStatus(document.getElementById('decryptStatus'), 
                   document.getElementById('decryptStatusText'), 
                   'error', `‚ùå Error: ${error.message}`);
    }
}

// Utility functions
function showStatus(container, textElem, type, message) {
    container.classList.remove('hidden', 'info', 'success', 'error', 'warning');
    container.classList.add(type);
    textElem.innerHTML = message;
}

function showLoading(text) {
    loadingText.textContent = text;
    loadingOverlay.classList.add('show');
}

function hideLoading() {
    loadingOverlay.classList.remove('show');
}

console.log('üîê FrDCT Encryption page loaded');
</script>
{% endblock %}
